(include_subdirs unqualified)

(rule
 (copy %{project_root}/config.ml config.ml))

(subdir parsing
  (ocamllex lexer))

(subdir parsing
  (menhir (modules parser) (infer true) (flags --explain --table)
  ))

; all the modules necessary to generate an ast
(library
  (name ast_lib)
  (public_name zrun.ast_lib)
  (wrapped false)
  (modules
    config misc
    lexer parser parsetree
    ident lident defnames location util ast write scoping pp_tools printer)
  (libraries menhirLib))

; all the necessary modules to make zrun except the entry module
(library
  (name zrun_lib)
  (public_name zrun.zrun_lib)
  (wrapped false)
  (modules
    error value debug genv primitives find match
    arrays combinatorial fix monad coiteration output
    forloop eval)
  (libraries zrun.ast_lib))

(executable
 (name zrun)
  (modes (byte exe))
  (modules zrun)
  (libraries zrun.ast_lib zrun.zrun_lib)
  (promote (until-clean) (into ..)))

(install
 (package zrun)
 (section bin)
 (files (zrun.exe as zrun)))


